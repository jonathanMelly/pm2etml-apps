@push('custom-scripts')
    @once
        @vite('resources/js/dashboard-charts.js')
    @endonce
@endpush

<div id="summariesCharts" class="w-[100%] overflow-x-auto">
</div>
<div id="evolutionCharts" class="w-[100%]">
</div>

<script type="module">
    String.prototype.limit = function(max) {
        const after = "...";
        return this.length > max - after.length ? this.substring(0, max - after.length) + after : this.toString();
    }

    const theme = '{{ \App\Http\Middleware\Theme::isDark(session('theme')) ? 'dark' : 'light' }}';

    const labels = {
        "date": "{{ __('Date') }}",
        "projectName": '{{ __('Project') }}',
        "clients": "Clients",
        "evolution": '{{ __('Evolution') }}',
        "result": '{{ __('Result') }}',
        "summary": '{{ __('Current summary') }}',
        "students": 'élève(s)'
    };

    const allJsonData = {!! $summary !!};
    {{-- const allJsonData = {"evaluations":{"cin1c":{"ryan k.":[["2023-02-22 01:39",100,24,24,24,24,"P_WebDB : Mod\u00e9liser un site web","antoine m."]],"quentin m.":[["2023-02-22 01:39",100,24,24,24,24,"P_WebDB : Mod\u00e9liser un site web","antoine m."]],"matthieu r.":[["2023-02-22 01:39",100,24,24,24,24,"P_WebDB : Mod\u00e9liser un site web","antoine m."]],"julian luca d.":[["2023-02-22 01:39",100,24,24,24,24,"P_WebDB : Mod\u00e9liser un site web","antoine m."],["2023-04-26 02:15",100,24,24,48,48,"P_SYS : Premier PC","helder c."]],"anakin jeremy j.":[["2023-02-22 01:39",100,24,24,24,24,"P_WebDB : Mod\u00e9liser un site web","antoine m."]],"julien m.":[["2023-02-22 01:39",100,24,24,24,24,"P_WebDB : Mod\u00e9liser un site web","antoine m."]],"esteban alexis l.":[["2023-02-22 01:39",100,24,24,24,24,"P_WebDB : Mod\u00e9liser un site web","antoine m."],["2023-04-26 02:15",100,24,24,48,48,"P_SYS : Premier PC","helder c."]],"thibaud no\u00e9 r.":[["2023-02-22 01:39",100,24,24,24,24,"P_WebDB : Mod\u00e9liser un site web","antoine m."],["2023-04-26 02:15",100,24,24,48,48,"P_SYS : Premier PC","helder c."]],"thomas m.":[["2023-02-22 01:39",100,24,24,24,24,"P_WebDB : Mod\u00e9liser un site web","antoine m."],["2023-04-26 02:15",100,24,24,48,48,"P_SYS : Premier PC","helder c."]],"mathias andr\u00e9 m.":[["2023-02-22 01:39",100,24,24,24,24,"P_WebDB : Mod\u00e9liser un site web","antoine m."],["2023-04-26 02:15",50,0,24,24,48,"P_SYS : Premier PC","helder c."]],"yohan jacques c.":[["2023-04-26 02:15",100,24,24,24,24,"P_SYS : Premier PC","helder c."]],"cyril constant n.":[["2023-02-22 01:39",100,24,24,24,24,"P_WebDB : Mod\u00e9liser un site web","antoine m."],["2023-04-26 02:15",100,24,24,48,48,"P_SYS : Premier PC","helder c."]],"francesco f.":[["2023-02-22 01:39",100,24,24,24,24,"P_WebDB : Mod\u00e9liser un site web","antoine m."],["2023-04-26 02:15",50,0,24,24,48,"P_SYS : Premier PC","helder c."]],"rayan timo b.":[["2023-02-22 01:39",100,24,24,24,24,"P_WebDB : Mod\u00e9liser un site web","antoine m."]],"timothy noah j.":[["2023-02-22 01:39",100,24,24,24,24,"P_WebDB : Mod\u00e9liser un site web","antoine m."],["2023-04-26 02:15",100,24,24,48,48,"P_SYS : Premier PC","helder c."]],"mussa a.":[["2023-02-22 01:39",100,24,24,24,24,"P_WebDB : Mod\u00e9liser un site web","antoine m."],["2023-04-26 02:15",100,24,24,48,48,"P_SYS : Premier PC","helder c."]]},"cin1b":{"alo\u00efs michel charles m.":[["2022-11-04 07:51",100,32,32,32,32,"P_INNO : Voyage d'\u00e9tude","bertrand s."],["2022-11-04 09:33",100,24,24,56,56,"P_SYS : Premier PC","bertrand s."],["2023-04-26 02:23",100,24,24,80,80,"P_WebDB : Mod\u00e9liser un site web","helder c."]],"mattis v.":[["2022-11-04 07:51",100,32,32,32,32,"P_INNO : Voyage d'\u00e9tude","bertrand s."],["2022-11-04 09:37",57,0,24,32,56,"P_SYS : Premier PC","bertrand s."],["2023-04-26 02:23",40,0,24,32,80,"P_WebDB : Mod\u00e9liser un site web","helder c."]],"mathis b.":[["2022-11-03 04:02",100,32,32,32,32,"P_INNO : Voyage d'\u00e9tude","bertrand s."],["2022-11-04 09:37",57,0,24,32,56,"P_SYS : Premier PC","bertrand s."],["2023-04-26 02:23",40,0,24,32,80,"P_WebDB : Mod\u00e9liser un site web","helder c."]],"karim d.":[["2022-11-04 07:50",0,0,32,0,32,"P_INNO : Voyage d'\u00e9tude","bertrand s."],["2022-11-04 09:35",0,0,24,0,56,"P_SYS : Premier PC","bertrand s."],["2023-04-26 02:23",0,0,24,0,80,"P_WebDB : Mod\u00e9liser un site web","helder c."]],"danilo z.":[["2022-11-04 07:51",100,32,32,32,32,"P_INNO : Voyage d'\u00e9tude","bertrand s."],["2022-11-04 09:37",57,0,24,32,56,"P_SYS : Premier PC","bertrand s."],["2023-04-26 02:23",40,0,24,32,80,"P_WebDB : Mod\u00e9liser un site web","helder c."]],"ethan aymeric s.":[["2022-11-04 07:51",100,32,32,32,32,"P_INNO : Voyage d'\u00e9tude","bertrand s."],["2022-11-04 09:33",100,24,24,56,56,"P_SYS : Premier PC","bertrand s."],["2023-02-23 08:19",100,24,24,80,80,"P_WebDB : Analyse d'informations personnelles","antoine m."],["2023-04-22 05:41",100,24,24,104,104,"Infrastructure r\u00e9seau d'une salle de cours","karim b."],["2023-04-26 02:23",100,24,24,128,128,"P_WebDB : Mod\u00e9liser un site web","helder c."]],"sofiene habib b.":[["2022-11-03 04:02",100,32,32,32,32,"P_INNO : Voyage d'\u00e9tude","bertrand s."],["2022-11-04 09:35",57,0,24,32,56,"P_SYS : Premier PC","bertrand s."],["2023-04-26 02:23",70,24,24,56,80,"P_WebDB : Mod\u00e9liser un site web","helder c."]],"adrian federico t.":[["2022-11-04 07:51",100,32,32,32,32,"P_INNO : Voyage d'\u00e9tude","bertrand s."],["2022-11-04 09:33",100,24,24,56,56,"P_SYS : Premier PC","bertrand s."],["2023-04-26 02:23",100,24,24,80,80,"P_WebDB : Mod\u00e9liser un site web","helder c."]],"mohammad dawood a.":[["2022-11-03 04:01",100,32,32,32,32,"P_INNO : Voyage d'\u00e9tude","bertrand s."],["2022-11-04 09:33",100,24,24,56,56,"P_SYS : Premier PC","bertrand s."],["2023-02-23 08:18",100,24,24,80,80,"P_WebDB : Analyse d'informations personnelles","antoine m."],["2023-04-26 02:23",77,0,24,80,104,"P_WebDB : Mod\u00e9liser un site web","helder c."]],"mateen salem k.":[["2022-11-04 07:51",100,32,32,32,32,"P_INNO : Voyage d'\u00e9tude","bertrand s."],["2022-11-04 09:37",57,0,24,32,56,"P_SYS : Premier PC","bertrand s."],["2023-04-26 02:23",70,24,24,56,80,"P_WebDB : Mod\u00e9liser un site web","helder c."]],"abiram m.":[["2022-11-04 07:51",0,0,32,0,32,"P_INNO : Voyage d'\u00e9tude","bertrand s."],["2022-11-04 09:37",0,0,24,0,56,"P_SYS : Premier PC","bertrand s."],["2023-04-26 02:23",0,0,24,0,80,"P_WebDB : Mod\u00e9liser un site web","helder c."]],"younes abdelhamid c.":[["2022-11-03 04:02",100,32,32,32,32,"P_INNO : Voyage d'\u00e9tude","bertrand s."],["2022-11-04 09:35",57,0,24,32,56,"P_SYS : Premier PC","bertrand s."]],"evan dimitri f.":[["2022-11-04 07:51",100,32,32,32,32,"P_INNO : Voyage d'\u00e9tude","bertrand s."],["2022-11-04 09:37",57,0,24,32,56,"P_SYS : Premier PC","bertrand s."],["2023-04-26 02:23",70,24,24,56,80,"P_WebDB : Mod\u00e9liser un site web","helder c."]],"julien pierre m.":[["2022-11-04 07:51",100,32,32,32,32,"P_INNO : Voyage d'\u00e9tude","bertrand s."],["2022-11-04 09:33",100,24,24,56,56,"P_SYS : Premier PC","bertrand s."],["2023-04-26 02:23",100,24,24,80,80,"P_WebDB : Mod\u00e9liser un site web","helder c."]],"evin p.":[["2022-11-04 07:51",100,32,32,32,32,"P_INNO : Voyage d'\u00e9tude","bertrand s."],["2022-11-04 09:37",57,0,24,32,56,"P_SYS : Premier PC","bertrand s."],["2023-04-26 02:23",70,24,24,56,80,"P_WebDB : Mod\u00e9liser un site web","helder c."]]},"cin1a":{"lucas pierre nangawi k.":[["2022-12-09 03:46",100,32,32,32,32,"P_INNO : Voyage d'\u00e9tude","alain g."]],"diego fernando m.":[["2022-12-09 03:46",100,32,32,32,32,"P_INNO : Voyage d'\u00e9tude","alain g."]],"giovanni b.":[["2022-12-09 03:46",100,32,32,32,32,"P_INNO : Voyage d'\u00e9tude","alain g."],["2023-01-27 02:30",100,24,24,56,56,"P_WebDB : Analyse d'informations personnelles","alain g."]],"luke raimondo m.":[["2022-12-09 03:46",100,32,32,32,32,"P_INNO : Voyage d'\u00e9tude","alain g."]],"alan b.":[["2022-12-09 03:46",100,32,32,32,32,"P_INNO : Voyage d'\u00e9tude","alain g."]],"teo l.":[["2022-12-09 03:46",100,32,32,32,32,"P_INNO : Voyage d'\u00e9tude","alain g."]],"siem b.":[["2022-12-09 03:46",100,32,32,32,32,"P_INNO : Voyage d'\u00e9tude","alain g."]],"nikola g.":[["2022-12-09 03:46",100,32,32,32,32,"P_INNO : Voyage d'\u00e9tude","alain g."]],"mohamed zaahid m.":[["2022-12-09 03:46",100,32,32,32,32,"P_INNO : Voyage d'\u00e9tude","alain g."]],"even gavri\u00ebl m.":[["2022-12-09 03:46",100,32,32,32,32,"P_INNO : Voyage d'\u00e9tude","alain g."]],"rui pedro r.":[["2022-12-09 03:46",100,32,32,32,32,"P_INNO : Voyage d'\u00e9tude","alain g."]],"william andres t.":[["2022-12-09 03:46",100,32,32,32,32,"P_INNO : Voyage d'\u00e9tude","alain g."]],"amir z.":[["2022-12-09 03:46",100,32,32,32,32,"P_INNO : Voyage d'\u00e9tude","alain g."]],"nima amir aram z.":[["2022-12-09 03:46",100,32,32,32,32,"P_INNO : Voyage d'\u00e9tude","alain g."]],"dario jhesuanj c.":[["2022-12-09 03:46",100,32,32,32,32,"P_INNO : Voyage d'\u00e9tude","alain g."]],"surenthar j.":[["2022-12-09 03:46",100,32,32,32,32,"P_INNO : Voyage d'\u00e9tude","alain g."]]},"cin2b":{"nelson p.":[["2023-04-26 02:23",100,24,24,24,24,"P_WebDB : Mod\u00e9liser un site web","helder c."]],"matej r.":[["2023-04-26 02:29",0,0,24,0,24,"P_WebDB : Mod\u00e9liser un site web","helder c."]]}},"summaries":{"cin1c":{"all":[14,["ryan k.","quentin m.","matthieu r.","julian luca d.","anakin jeremy j.","julien m.","esteban alexis l.","thibaud no\u00e9 r.","thomas m.","yohan jacques c.","cyril constant n.","rayan timo b.","timothy noah j.","mussa a."],2,["mathias andr\u00e9 m.","francesco f."]],"ryan k.":[24,["P_WebDB : Mod\u00e9liser un site web"],0,[]],"quentin m.":[24,["P_WebDB : Mod\u00e9liser un site web"],0,[]],"matthieu r.":[24,["P_WebDB : Mod\u00e9liser un site web"],0,[]],"julian luca d.":[48,["P_WebDB : Mod\u00e9liser un site web","P_SYS : Premier PC"],0,[]],"anakin jeremy j.":[24,["P_WebDB : Mod\u00e9liser un site web"],0,[]],"julien m.":[24,["P_WebDB : Mod\u00e9liser un site web"],0,[]],"esteban alexis l.":[48,["P_WebDB : Mod\u00e9liser un site web","P_SYS : Premier PC"],0,[]],"thibaud no\u00e9 r.":[48,["P_WebDB : Mod\u00e9liser un site web","P_SYS : Premier PC"],0,[]],"thomas m.":[48,["P_WebDB : Mod\u00e9liser un site web","P_SYS : Premier PC"],0,[]],"mathias andr\u00e9 m.":[24,["P_WebDB : Mod\u00e9liser un site web"],24,["P_SYS : Premier PC"]],"yohan jacques c.":[24,["P_SYS : Premier PC"],0,[]],"cyril constant n.":[48,["P_WebDB : Mod\u00e9liser un site web","P_SYS : Premier PC"],0,[]],"francesco f.":[24,["P_WebDB : Mod\u00e9liser un site web"],24,["P_SYS : Premier PC"]],"rayan timo b.":[24,["P_WebDB : Mod\u00e9liser un site web"],0,[]],"timothy noah j.":[48,["P_WebDB : Mod\u00e9liser un site web","P_SYS : Premier PC"],0,[]],"mussa a.":[48,["P_WebDB : Mod\u00e9liser un site web","P_SYS : Premier PC"],0,[]]},"cin1b":{"all":[4,["alo\u00efs michel charles m.","ethan aymeric s.","adrian federico t.","julien pierre m."],11,["mattis v.","mathis b.","karim d.","danilo z.","sofiene habib b.","mohammad dawood a.","mateen salem k.","abiram m.","younes abdelhamid c.","evan dimitri f.","evin p."]],"alo\u00efs michel charles m.":[80,["P_INNO : Voyage d'\u00e9tude","P_SYS : Premier PC","P_WebDB : Mod\u00e9liser un site web"],0,[]],"mattis v.":[32,["P_INNO : Voyage d'\u00e9tude"],48,["P_SYS : Premier PC","P_WebDB : Mod\u00e9liser un site web"]],"mathis b.":[32,["P_INNO : Voyage d'\u00e9tude"],48,["P_SYS : Premier PC","P_WebDB : Mod\u00e9liser un site web"]],"karim d.":[0,[],80,["P_INNO : Voyage d'\u00e9tude","P_SYS : Premier PC","P_WebDB : Mod\u00e9liser un site web"]],"danilo z.":[32,["P_INNO : Voyage d'\u00e9tude"],48,["P_SYS : Premier PC","P_WebDB : Mod\u00e9liser un site web"]],"ethan aymeric s.":[128,["P_INNO : Voyage d'\u00e9tude","P_SYS : Premier PC","P_WebDB : Analyse d'informations personnelles","Infrastructure r\u00e9seau d'une salle de cours","P_WebDB : Mod\u00e9liser un site web"],0,[]],"sofiene habib b.":[56,["P_INNO : Voyage d'\u00e9tude","P_WebDB : Mod\u00e9liser un site web"],24,["P_SYS : Premier PC"]],"adrian federico t.":[80,["P_INNO : Voyage d'\u00e9tude","P_SYS : Premier PC","P_WebDB : Mod\u00e9liser un site web"],0,[]],"mohammad dawood a.":[80,["P_INNO : Voyage d'\u00e9tude","P_SYS : Premier PC","P_WebDB : Analyse d'informations personnelles"],24,["P_WebDB : Mod\u00e9liser un site web"]],"mateen salem k.":[56,["P_INNO : Voyage d'\u00e9tude","P_WebDB : Mod\u00e9liser un site web"],24,["P_SYS : Premier PC"]],"abiram m.":[0,[],80,["P_INNO : Voyage d'\u00e9tude","P_SYS : Premier PC","P_WebDB : Mod\u00e9liser un site web"]],"younes abdelhamid c.":[32,["P_INNO : Voyage d'\u00e9tude"],24,["P_SYS : Premier PC"]],"evan dimitri f.":[56,["P_INNO : Voyage d'\u00e9tude","P_WebDB : Mod\u00e9liser un site web"],24,["P_SYS : Premier PC"]],"julien pierre m.":[80,["P_INNO : Voyage d'\u00e9tude","P_SYS : Premier PC","P_WebDB : Mod\u00e9liser un site web"],0,[]],"evin p.":[56,["P_INNO : Voyage d'\u00e9tude","P_WebDB : Mod\u00e9liser un site web"],24,["P_SYS : Premier PC"]]},"cin1a":{"all":[16,["lucas pierre nangawi k.","diego fernando m.","giovanni b.","luke raimondo m.","alan b.","teo l.","siem b.","nikola g.","mohamed zaahid m.","even gavri\u00ebl m.","rui pedro r.","william andres t.","amir z.","nima amir aram z.","dario jhesuanj c.","surenthar j."],0,[]],"lucas pierre nangawi k.":[32,["P_INNO : Voyage d'\u00e9tude"],0,[]],"diego fernando m.":[32,["P_INNO : Voyage d'\u00e9tude"],0,[]],"giovanni b.":[56,["P_INNO : Voyage d'\u00e9tude","P_WebDB : Analyse d'informations personnelles"],0,[]],"luke raimondo m.":[32,["P_INNO : Voyage d'\u00e9tude"],0,[]],"alan b.":[32,["P_INNO : Voyage d'\u00e9tude"],0,[]],"teo l.":[32,["P_INNO : Voyage d'\u00e9tude"],0,[]],"siem b.":[32,["P_INNO : Voyage d'\u00e9tude"],0,[]],"nikola g.":[32,["P_INNO : Voyage d'\u00e9tude"],0,[]],"mohamed zaahid m.":[32,["P_INNO : Voyage d'\u00e9tude"],0,[]],"even gavri\u00ebl m.":[32,["P_INNO : Voyage d'\u00e9tude"],0,[]],"rui pedro r.":[32,["P_INNO : Voyage d'\u00e9tude"],0,[]],"william andres t.":[32,["P_INNO : Voyage d'\u00e9tude"],0,[]],"amir z.":[32,["P_INNO : Voyage d'\u00e9tude"],0,[]],"nima amir aram z.":[32,["P_INNO : Voyage d'\u00e9tude"],0,[]],"dario jhesuanj c.":[32,["P_INNO : Voyage d'\u00e9tude"],0,[]],"surenthar j.":[32,["P_INNO : Voyage d'\u00e9tude"],0,[]]},"cin2b":{"all":[1,["nelson p."],1,["matej r."]],"nelson p.":[24,["P_WebDB : Mod\u00e9liser un site web"],0,[]],"matej r.":[0,[],24,["P_WebDB : Mod\u00e9liser un site web"]]}},"datesWindow":["2022-08-01 12:00","2023-07-31 12:00","2023-03-06 11:00","2023-06-11 11:00"],"groupsCount":4}; --}}


    let {
        initialSummaryTop,
        summaryTop,
        summariesChartOption
    } =
    prepareSummariesChartData(allJsonData, {{ \App\Services\SummariesService::SUCCESS_REQUIREMENT }}, labels);

    let {
        groupsForEvaluation,
        evolutionChartOption
    } =
    prepareEvaluationChartsData(allJsonData, {{ \App\Services\SummariesService::SUCCESS_REQUIREMENT }}, labels);

    //Create chart
    let evolutionChart = echarts.init(document.getElementById('evolutionCharts'), theme, {
        //width: '100%',
        height: 285 * groupsForEvaluation.length,
        //https://github.com/apexcharts/apexcharts.js/issues/937
        zoom: {
            enabled: false
        }
    });
    evolutionChart.setOption(evolutionChartOption);

    //Create chart
    let summariesChart = echarts.init(document.getElementById('summariesCharts'), theme, {
        //width: '100%',
        height: (summaryTop - initialSummaryTop), // maxTop+groupRadius*3
        //https://github.com/apexcharts/apexcharts.js/issues/937
        zoom: {
            enabled: false
        }
    });
    summariesChart.setOption(summariesChartOption);

    window.addEventListener('resize', function() {
        [evolutionChart, summariesChart].forEach(chart => chart.resize());
    });
</script>
